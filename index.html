<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>

<body>

    <script>
        var char;
        MOVE_SPEED = 250
        KNIFE_SPEED = 500
        knives = []
        var knife_count = 10

        var config = {
            type: Phaser.AUTO,
            width: 1000,
            height: 1000,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 }
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        var game = new Phaser.Game(config);

        function preload() {
            this.load.image('knife', 'assets/knife.png');
            this.load.image('chowder', 'assets/chowder.png');
        }

        function create() {
            char = this.physics.add.image(400, 300, 'chowder');
            char.setCollideWorldBounds(true);
            keys = this.input.keyboard.addKeys("W,A,S,D");

            // Knife spawn timer
            this.time.addEvent({
                delay: 300,
                callback: function() {
                    knife = this.physics.add.image(char.x, char.y, 'knife')
                    knife.setScale(.1)
                    knife.setVelocityX(knifeSpeedX)
                    knife.setVelocityY(knifeSpeedY)
                    knife.rotation = (knifeSpeedX > 0 ? 90 : 0) + (knifeSpeedY > 0 ? 90 : 0)

                    knives.push(knife)
                    if (knives.length > 5)
                        knives.shift().destroy()
                },
                callbackScope: this,
                loop: true,
            });

            // Set initial knife speed
            knifeSpeedX = KNIFE_SPEED
            knifeSpeedY = 0
        }

        function update() {
            if (keys.A.isDown) {
                char.setVelocityX(-MOVE_SPEED)
                knifeSpeedX = -KNIFE_SPEED
            } else if (keys.D.isDown) {
                knifeSpeedX = KNIFE_SPEED
                char.setVelocityX(MOVE_SPEED)
            } else {
                char.setVelocityX(0)
                if (keys.W.isDown || keys.S.isDown)
                    knifeSpeedX = 0
            }

            if (keys.W.isDown) {
                knifeSpeedY = -KNIFE_SPEED
                char.setVelocityY(-MOVE_SPEED)
            } else if (keys.S.isDown) {
                knifeSpeedY = KNIFE_SPEED
                char.setVelocityY(MOVE_SPEED)
            } else {
                char.setVelocityY(0)
                if (keys.A.isDown || keys.D.isDown)
                    knifeSpeedY = 0
            }
        }
    </script>

</body>

</html>